<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      hr {
        margin-top: 30px;
      }
    </style>
    <script type="module">
      import { auth } from "/api/request.js";
      import * as authApi from "/api/auth.js";
      import * as usersApi from "/api/users.js";
      import * as postsApi from "/api/posts.js";
      import * as galleriesApi from "/api/galleries.js";

      authApi.getProfile();

      const getUsers = async () => {
        usersOutput.innerHTML = "Loading...";
        const data = await usersApi.getUsers();

        if (!data?.success) return (usersOutput.innerHTML = "");
        console.log(data, "data-users");

        usersOutput.innerHTML = "";

        data.data.forEach((user) => {
          const card = document.createElement('div')

          const img = document.createElement("img");
          img.src = `${user.avatar || "/assets/images/avatar-placeholder.png"}`;
          img.style.display = "block";
          img.style.width = "50px";
          img.style.height = "50px";
          img.style.objectFit = "cover";
          card.appendChild(img);

          const div = document.createElement("div");
          div.textContent = `${user.name}`;
          card.appendChild(div);

          const detailsButton = document.createElement("button");
          detailsButton.innerHTML = `<a href="/dashboard/users/${user._id}">Details</a>`;
          card.appendChild(detailsButton);
          
          usersOutput.appendChild(card);
        });
      };

      const getPosts = async () => {
        postsOutput.innerHTML = "Loading...";
        const data = await postsApi.getPosts();

        if (!data?.success) return (postsOutput.innerHTML = "");
        console.log(data, "data-posts");

        postsOutput.innerHTML = "";

        data.data.forEach((post) => {
          const card = document.createElement('div')

          const img = document.createElement("img");
          img.src = `${post.cover || "/assets/images/post-placeholder.jpg"}`;
          img.style.display = "block";
          img.style.width = "50px";
          img.style.height = "50px";
          img.style.objectFit = "cover";
          card.appendChild(img);

          const div = document.createElement("div");
          div.textContent = `${post.name} (${post.author})`;
          card.appendChild(div);

          const detailsButton = document.createElement("button");
          detailsButton.innerHTML = `<a href="/dashboard/posts/${post._id}">Details</a>`;
          card.appendChild(detailsButton);
          
          postsOutput.appendChild(card);
        });
      };

      const logout = async () => {
        const data = await authApi.logout();
        if (!data?.success) return;
        console.log(data, "data-logout");
      };

      document.querySelector("button#get-users-btn").addEventListener("click", getUsers);
      document.querySelector("button#get-posts-btn").addEventListener("click", getPosts);
      document.querySelector("button#logout-btn").addEventListener("click", logout);
    </script>
  </head>
  <body>
    <a href="/">website</a>
    <a href="/dashboard/profile">profile</a>
    <a href="/dashboard/settings">settings</a>
    <hr />
    <h1>Dashboard</h1>
    <hr />

    <button class="" id="get-users-btn">Get users</button>
    <br />
    <div id="usersOutput"  style="display:flex;gap: 50px;">Empty</div>
    <hr />

    <button class="" id="get-posts-btn">Get posts</button>
    <br />
    <div id="postsOutput" style="display:flex;gap: 50px;">Empty</div>
    <hr />

    <button class="" id="logout-btn">Logout</button>
    <hr />
  </body>
</html>
